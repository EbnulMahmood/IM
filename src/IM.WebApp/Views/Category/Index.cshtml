@using IM.UseCases.Dtos.Enums
@model IEnumerable<CategoryDto>
@{
    ViewData["Title"] = "Categories";
}

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css">

<div class="container p-3">
    <div class="row pt-4">
        <div id="modal-placeholder-category"></div>
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Category</li>
                </ol>
            </nav>
        </div>
        <div class="col-6">
            <h2 class="text-primary">@ViewData["Title"]</h2>
        </div>
        <div class="col-6 text-end">
            <a asp-controller="Category" asp-action="Create" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i>&nbsp; Create
            </a>
        </div>
    </div>
    <br>
    <br>
    <div class="row">
        <div class="col-md-3 p-3">
            <input class="form-control" type="text" id="search-by-name" placeholder="Search Name" />
        </div>
        <div class="col-md-3 p-3">
            <select class="form-control" id="filter-by-status">
                <option selected value="">Select Status</option>
                <option value="@StatusDto.Active">Active</option>
                <option value="@StatusDto.Inactive">Inactive</option>
            </select>
        </div>
    </div>
    <br>
    <div class="table-responsive">
        <table id="categoryDatatable" class="table table-striped">
            <thead>
                <tr>
                    <th class="w-50">Name</th>
                    <th class="w-25">Status</th>
                    <th class="w-25">Action</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

@section Scripts {
    <script src="//cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="~/js/datatable.js" asp-append-version="true"></script>
    
    <script>
        const filterSearchOptionsForCategory = () => {
            return {
                searchByName: "#search-by-name",
                filterByStatus: "#filter-by-status",
            }
        }
        const categoryDatatableId = '#categoryDatatable';
        const categoryIndexUrl = 'Category/Index';

        $(document).ready(function () {
            
            DataTable(categoryDatatableId, categoryIndexUrl,
                filterSearchOptionsForCategory);
        });
    </script>

    <script>
        // modal
        const showModal = (url, PlaceHolderElement) => {
            const decodeUrl = decodeURIComponent(url);
            $.get(decodeUrl).done(function (data) {
                PlaceHolderElement.html(data);
                PlaceHolderElement.find('.modal').modal('show');
            })
        }
        const modalAction = (PlaceHolderElement, that) => {
            const form = that.parents('.modal').find('form');
            const actionUrl = form.attr('action');
            const sendData = form.serialize();
            $.post(actionUrl, sendData).done(function (data) {
                PlaceHolderElement.find('.modal').modal('hide');
                window.location.reload();
            })
        }
        $(function () {
            const PlaceHolderElementDev = $('#modal-placeholder-category');
            $(document).on("click", ".btn-category-delete", function () {
                const id = $(this).attr('data-category-id');
                const url = `Delete/${id}`;
                showModal(url, PlaceHolderElementDev);
            });
            PlaceHolderElementDev.on('click', '[data-bs-save="modal"]', function (e) {
                modalAction(PlaceHolderElementDev, $(this))
            })
        })
    </script>
}