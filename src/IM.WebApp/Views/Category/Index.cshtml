@using IM.UseCases.Dtos.Enums
@model IEnumerable<CategoryDto>
@{
    ViewData["Title"] = "Categories";
}

<div class="container p-3">
    <div class="row pt-4">
        <div id="modal-placeholder-category"></div>
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Category</li>
                </ol>
            </nav>
        </div>
        <div class="col-6">
            <h2 class="text-primary">@ViewData["Title"]</h2>
        </div>
        <div class="col-6 text-end">
            <a asp-controller="Category" asp-action="Create" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i>&nbsp; Create
            </a>
        </div>
    </div>
    <br>
    <br>
    <div class="row">
        <div class="col-md-3">
            <input class="form-control" type="text" id="search-input" placeholder="Search Name" />
        </div>
        <div class="col-md-3">
            <select class="form-control" id="sort-by">
                <option selected value="">Select Status</option>
                <option value="@StatusDto.Active">Active</option>
                <option value="@StatusDto.Inactive">Inactive</option>
            </select>
        </div>
    </div>
    <br>
    <div class="table-responsive">
        <table id="categoryDatatable" class="table w-auto table-striped">
            <thead>
                <tr class="d-flex">
                    <th>Name</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        // DataTable
        $(document).ready(function () {
            const categoryDataTable = (tableId, url) => {
                const customDataTable = $(tableId).DataTable({
                    processing: true,
                    bServerSide: true,
                    serverSide: true,
                    sort: true,
                    searching: false,
                    columnDefs: [
                        { orderable: false, targets: -1 }
                    ],
                    dom: '<"top"l>rt<"bottom"ip><"clear">',
                    ajax: {
                        url: url,
                        type: "POST",
                        dataType: "json",
                        data: (data) => {
                            return $.extend({}, data, {
                                "filter_keywords": $("#search-input").val().toLowerCase(),
                                "filter_option": $("#sort-by").val().toLowerCase(),
                            })
                        }
                    },
                    createdRow: (row, data, dataIndex) => {
                        $(row).addClass( 'd-flex justify-content-end' );
                        console.log('row-> ', row)
                        console.log('data-> ', data)
                        console.log('dataIndex-> ', dataIndex)
                    },
                });
                customDataTable.draw();
                $("#search-input, #sort-by").bind("keyup change clear", () => customDataTable.draw());
            }
            categoryDataTable('#categoryDatatable', "Category/Index");
        });
        // modal
        const showModal = (url, PlaceHolderElement) => {
            const decodeUrl = decodeURIComponent(url);
            $.get(decodeUrl).done(function (data) {
                PlaceHolderElement.html(data);
                PlaceHolderElement.find('.modal').modal('show');
            })
        }
        const modalAction = (PlaceHolderElement, that) => {
            const form = that.parents('.modal').find('form');
            const actionUrl = form.attr('action');
            const sendData = form.serialize();
            console.log(actionUrl, sendData)
            $.post(actionUrl, sendData).done(function (data) {
                PlaceHolderElement.find('.modal').modal('hide');
                window.location.reload();
            })
        }
        $(function () {
            const PlaceHolderElementDev = $('#modal-placeholder-category');
            $(document).on("click", ".btn-category-delete", function () {
                const id = $(this).attr('data-category-id');
                const url = `Delete/${id}`;
                showModal(url, PlaceHolderElementDev);
            });
            PlaceHolderElementDev.on('click', '[data-bs-save="modal"]', function (e) {
                modalAction(PlaceHolderElementDev, $(this))
            })
        })
    </script>
}